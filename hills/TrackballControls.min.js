THREE.TrackballControls=function(e,t){function b(e){if(n.enabled===false)return;window.removeEventListener("keydown",b);o=s;if(s!==r.NONE){return}else if(e.keyCode===n.keys[r.ROTATE]&&!n.noRotate){s=r.ROTATE}else if(e.keyCode===n.keys[r.ZOOM]&&!n.noZoom){s=r.ZOOM}else if(e.keyCode===n.keys[r.PAN]&&!n.noPan){s=r.PAN}}function w(e){if(n.enabled===false)return;s=o;window.addEventListener("keydown",b,false)}function E(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();if(s===r.NONE){s=e.button}if(s===r.ROTATE&&!n.noRotate){n.getMouseProjectionOnBall(e.pageX,e.pageY,a);f.copy(a)}else if(s===r.ZOOM&&!n.noZoom){n.getMouseOnScreen(e.pageX,e.pageY,l);c.copy(l)}else if(s===r.PAN&&!n.noPan){n.getMouseOnScreen(e.pageX,e.pageY,d);v.copy(d)}document.addEventListener("mousemove",S,false);document.addEventListener("mouseup",x,false);n.dispatchEvent(g)}function S(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();if(s===r.ROTATE&&!n.noRotate){n.getMouseProjectionOnBall(e.pageX,e.pageY,f)}else if(s===r.ZOOM&&!n.noZoom){n.getMouseOnScreen(e.pageX,e.pageY,c)}else if(s===r.PAN&&!n.noPan){n.getMouseOnScreen(e.pageX,e.pageY,v)}}function x(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();s=r.NONE;document.removeEventListener("mousemove",S);document.removeEventListener("mouseup",x);n.dispatchEvent(y)}function T(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta){t=e.wheelDelta/40}else if(e.detail){t=-e.detail/3}l.y+=t*.01;n.dispatchEvent(g);n.dispatchEvent(y)}function N(e){if(n.enabled===false)return;switch(e.touches.length){case 1:s=r.TOUCH_ROTATE;f.copy(n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,a));break;case 2:s=r.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX;var i=e.touches[0].pageY-e.touches[1].pageY;p=h=Math.sqrt(t*t+i*i);break;case 3:s=r.TOUCH_PAN;v.copy(n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,d));break;default:s=r.NONE}n.dispatchEvent(g)}function C(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();switch(e.touches.length){case 1:n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,f);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX;var i=e.touches[0].pageY-e.touches[1].pageY;p=Math.sqrt(t*t+i*i);break;case 3:n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,v);break;default:s=r.NONE}}function k(e){if(n.enabled===false)return;switch(e.touches.length){case 1:a.copy(n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,f));break;case 2:h=p=0;break;case 3:d.copy(n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,v));break}s=r.NONE;n.dispatchEvent(y)}var n=this;var r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.noRoll=false;this.staticMoving=false;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var i=new THREE.Vector3;var s=r.NONE,o=r.NONE,u=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector2,c=new THREE.Vector2,h=0,p=0,d=new THREE.Vector2,v=new THREE.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var m={type:"change"};var g={type:"start"};var y={type:"end"};this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{this.screen=this.domElement.getBoundingClientRect();var e=this.domElement.ownerDocument.documentElement;this.screen.left+=window.pageXOffset-e.clientLeft;this.screen.top+=window.pageYOffset-e.clientTop}};this.handleEvent=function(e){if(typeof this[e.type]=="function"){this[e.type](e)}};this.getMouseOnScreen=function(e,t,r){return r.set((e-n.screen.left)/n.screen.width,(t-n.screen.top)/n.screen.height)};this.getMouseProjectionOnBall=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i,s){t.set((r-n.screen.width*.5-n.screen.left)/(n.screen.width*.5),(n.screen.height*.5+n.screen.top-i)/(n.screen.height*.5),0);var o=t.length();if(n.noRoll){if(o<Math.SQRT1_2){t.z=Math.sqrt(1-o*o)}else{t.z=.5/o}}else if(o>1){t.normalize()}else{t.z=Math.sqrt(1-o*o)}u.copy(n.object.position).sub(n.target);s.copy(n.object.up).setLength(t.y);s.add(e.copy(n.object.up).cross(u).setLength(t.x));s.add(u.setLength(t.z));return s}}();this.rotateCamera=function(){var e=new THREE.Vector3,t=new THREE.Quaternion;return function(){var r=Math.acos(a.dot(f)/a.length()/f.length());if(r){e.crossVectors(a,f).normalize();r*=n.rotateSpeed;t.setFromAxisAngle(e,-r);u.applyQuaternion(t);n.object.up.applyQuaternion(t);f.applyQuaternion(t);if(n.staticMoving){a.copy(f)}else{t.setFromAxisAngle(e,r*(n.dynamicDampingFactor-1));a.applyQuaternion(t)}}}}();this.zoomCamera=function(){if(s===r.TOUCH_ZOOM){var e=h/p;h=p;u.multiplyScalar(e)}else{var e=1+(c.y-l.y)*n.zoomSpeed;if(e!==1&&e>0){u.multiplyScalar(e);if(n.staticMoving){l.copy(c)}else{l.y+=(c.y-l.y)*this.dynamicDampingFactor}}}};this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,r=new THREE.Vector3;return function(){e.copy(v).sub(d);if(e.lengthSq()){e.multiplyScalar(u.length()*n.panSpeed);r.copy(u).cross(n.object.up).setLength(e.x);r.add(t.copy(n.object.up).setLength(e.y));n.object.position.add(r);n.target.add(r);if(n.staticMoving){d.copy(v)}else{d.add(e.subVectors(v,d).multiplyScalar(n.dynamicDampingFactor))}}}}();this.checkDistances=function(){if(!n.noZoom||!n.noPan){if(u.lengthSq()>n.maxDistance*n.maxDistance){n.object.position.addVectors(n.target,u.setLength(n.maxDistance))}if(u.lengthSq()<n.minDistance*n.minDistance){n.object.position.addVectors(n.target,u.setLength(n.minDistance))}}};this.update=function(){u.subVectors(n.object.position,n.target);if(!n.noRotate){n.rotateCamera()}if(!n.noZoom){n.zoomCamera()}if(!n.noPan){n.panCamera()}n.object.position.addVectors(n.target,u);n.checkDistances();n.object.lookAt(n.target);if(i.distanceToSquared(n.object.position)>0){n.dispatchEvent(m);i.copy(n.object.position)}};this.reset=function(){s=r.NONE;o=r.NONE;n.target.copy(n.target0);n.object.position.copy(n.position0);n.object.up.copy(n.up0);u.subVectors(n.object.position,n.target);n.object.lookAt(n.target);n.dispatchEvent(m);i.copy(n.object.position)};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",E,false);this.domElement.addEventListener("mousewheel",T,false);this.domElement.addEventListener("DOMMouseScroll",T,false);this.domElement.addEventListener("touchstart",N,false);this.domElement.addEventListener("touchend",k,false);this.domElement.addEventListener("touchmove",C,false);window.addEventListener("keydown",b,false);window.addEventListener("keyup",w,false);this.handleResize()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype)